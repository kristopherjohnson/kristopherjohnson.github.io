<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Undefined Value - coreanimation</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Undefined Value </a></h1>
                <nav><ul>
                    <li><a href="/pages/about-me.html">About Me</a></li>
                    <li><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/core-animation-performance-tips.html">Core Animation Performance Tips</a></h1>
<footer class="post-info">
        <abbr class="published" title="2010-05-18T10:36:44-04:00">
                Published: Tue 18 May 2010
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/kristopher-johnson.html">Kristopher Johnson</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>
<p>tags: <a href="/tag/performance.html">performance</a> <a href="/tag/optimization.html">optimization</a> <a href="/tag/gamedevelopment.html">gamedevelopment</a> <a href="/tag/coreanimation.html">coreanimation</a> </p>
</footer><!-- /.post-info --><p>In my copious free time, I've been working on a videogame for the iPad. Friends and family may interject here that it seems like I'm <em>always</em> working on a videogame in my free time, but I've never actually finished one. This time is different. Really.</p>
<p>All of my personal projects are intended primarily to be interesting and fun for me. I gave myself a couple of technical constraints to keep things challenging:</p>
<ul>
<li>All the code is well-factored idiomatic Objective-C. Unlike a lot of iPhone/iPad game programmers, I'm not writing all the guts in low-level C or C++ and then sprinkling a minimal amount of Cocoa on top to interface with the OS.</li>
<li>I'm using Core&nbsp;Animation as my "engine", rather than the OpenGL ES API or an off-the-shelf gaming engine. (Note: My game only needs a couple dozen sprites.)</li>
</ul>
<p>So far, things have worked out well. I was worried that using Objective-C and Core&nbsp;Animation might lead to performance issues on the iPad, but that hasn't been the case. I have run into a couple of issues with Core&nbsp;Animation that were pretty easy to fix.
<!--break--></p>
<h3>Layer Creation Is Expensive</h3>
<p>My game's "sprites" are just Core&nbsp;Animation layers. When I initially implemented the game, I was creating layers and adding them to the view as needed, and then deleting them when they were no longer needed. This turned out to cause problems; a few frames would get dropped whenever a layer was created.</p>
<p>The fix for this was to create a pool of layers and add them all to the view at startup, and reuse those layers as needed. Unused layers get their <code>hidden</code> property set false.</p>
<h3>Watch Out for Misaligned Images</h3>
<p>If you run an app with Instruments with the Core Animation tool, it has an option to highlight "misaligned images." I couldn't find a lot of information on this, but apparently if you give layers positions that are not perfectly aligned to pixels, Core Animation does some anti-aliasing when rendering those layers, which degrades performance.</p>
<p>The easy fix is to just round all positions to whole pixels, via something like this:</p>
<div class="highlight"><pre><span></span>- (void) setSpritePosition:(CGPoint)position {
    CGPoint alignedPosition;
    alignedPosition.x = floorf(0.5f + position.x);
    alignedPosition.y = floorf(0.5f + position.y);
    sprite.position = alignedPosition;
}
</pre></div>


<p>This got rid of most of my misaligned images, but I do still have some sprites that get rotated or scaled via a transform, and such images are always misaligned, unless they are rotated by some multiple of 90 degrees. Thankfully, I only have a few such sprites.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/shiny-iphone-buttons-without-photoshop.html" rel="bookmark"
                           title="Permalink to Shiny iPhone Buttons Without Photoshop">Shiny iPhone Buttons Without Photoshop</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2010-02-27T12:16:43-05:00">
                Published: Sat 27 February 2010
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/kristopher-johnson.html">Kristopher Johnson</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>
<p>tags: <a href="/tag/tutorial.html">tutorial</a> <a href="/tag/samplecode.html">samplecode</a> <a href="/tag/iphone.html">iphone</a> <a href="/tag/iosdev.html">iosdev</a> <a href="/tag/coreanimation.html">coreanimation</a> </p>
</footer><!-- /.post-info -->                <p><img style="float: right;" src="http://undefinedvalue.com/sites/undefinedvalue.com/files/GradientButtonsAppScreenshot.png" alt="Screenshot"></p>
<p>Newcomers to iPhone development are sometimes surprised at how ugly the standard button controls are. They quickly learn that they need a graphic artist to create a nice-looking button image in Photoshop and then attach that to the buttons. However, in this tutorial, I'll show how to create nice shiny …</p>
                <a class="readmore" href="/shiny-iphone-buttons-without-photoshop.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/iphone-sample-code-tiles.html" rel="bookmark"
                           title="Permalink to iPhone Sample Code: Tiles">iPhone Sample Code: Tiles</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2010-02-06T04:28:21-05:00">
                Published: Sat 06 February 2010
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/kristopher-johnson.html">Kristopher Johnson</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>
<p>tags: <a href="/tag/samplecode.html">samplecode</a> <a href="/tag/iphone.html">iphone</a> <a href="/tag/iosdev.html">iosdev</a> <a href="/tag/coreanimation.html">coreanimation</a> </p>
</footer><!-- /.post-info -->                <p>As an exercise in using the <a href="http://en.wikipedia.org/wiki/Core_Animation">Core Animation</a> API, I've implemented a little iPhone app that reproduces the behavior of the iPhone home screen's icon reorganization interface. (You know, dragging the wiggly icons around.) You can download my sample code to see how it works. Some descriptions of the highlights …</p>
                <a class="readmore" href="/iphone-sample-code-tiles.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/review-core-animation-mac-os x-and-iphone-bill dudney.html" rel="bookmark"
                           title="Permalink to Review: Core Animation for Mac OS X and the iPhone, by Bill Dudney">Review: Core Animation for Mac OS X and the iPhone, by Bill Dudney</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2009-07-04T11:54:17-04:00">
                Published: Sat 04 July 2009
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/kristopher-johnson.html">Kristopher Johnson</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>.</p>
<p>tags: <a href="/tag/review.html">review</a> <a href="/tag/programming.html">programming</a> <a href="/tag/book.html">book</a> <a href="/tag/coreanimation.html">coreanimation</a> <a href="/tag/iphone.html">iphone</a> </p>
</footer><!-- /.post-info -->                <p>Either I’m stupid, or Apple’s developer documentation sucks. Whenever I try to enter a new area of Cocoa development, I am presented with simplistic tutorials and detailed reference information, with little in between to bridge the gap between newbie and expert. Often, the only way to learn an …</p>
                <a class="readmore" href="/review-core-animation-mac-os x-and-iphone-bill dudney.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>